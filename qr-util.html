<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Customized QR Code Generator with Paste</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 2rem;
    max-width: 400px;
    margin: auto;
    background: #121212;
    color: #e0e0e0;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
    color: #ffffff;
  }
  label {
    font-weight: bold;
    display: block;
    margin-bottom: 0.5rem;
    color: #cccccc;
  }
  input[type="url"], input[type="text"] {
    width: 100%;
    padding: 0.5rem;
    border: 2px solid #333;
    border-radius: 5px;
    margin-bottom: 1rem;
    font-size: 1rem;
    background: #1e1e1e;
    color: #e0e0e0;
  }
  input::placeholder {
    color: #888;
  }
  button {
    width: 30%;
    padding: 0.5rem;
    margin: 0.1rem 3.3% 1rem 3.3%;
    font-size: 1rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #pasteBtn {
    background-color: #6c757d;
    color: white;
  }
  #pasteBtn:hover {
    background-color: #5a6268;
  }
  #generateBtn {
    background-color: #007BFF;
    color: white;
  }
  #generateBtn:hover {
    background-color: #0056b3;
  }
  #downloadBtn {
    background-color: #28A745;
    color: white;
  }
  #downloadBtn:disabled {
    background-color: #5c7c5c;
    cursor: not-allowed;
  }
  #downloadBtn:hover:not(:disabled) {
    background-color: #1e7e34;
  }
  #qrcode {
    text-align: center;
    margin-top: 1rem;
  }
  #message {
    color: #ff6b6b;
    font-size: 0.9rem;
    text-align: center;
  }
</style>
</head>
<body>

<h1>Customized QR Code</h1>

<label for="urlInput">Enter URL</label>
<input type="url" id="urlInput" placeholder="https://example.com" autocomplete="off" />

<label for="customText">Add text or emojis (optional)</label>
<input type="text" id="customText" placeholder="ðŸŽ‰ Scan me! ðŸš€" maxlength="40" />

<div>
  <button id="pasteBtn">Paste</button>
  <button id="generateBtn">Generate QR Code</button>
  <button id="downloadBtn" disabled>Download</button>
</div>

<div id="qrcode"></div>
<div id="message"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
  const urlInput = document.getElementById('urlInput');
  const customTextInput = document.getElementById('customText');
  const generateBtn = document.getElementById('generateBtn');
  const pasteBtn = document.getElementById('pasteBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const qrCodeContainer = document.getElementById('qrcode');
  const message = document.getElementById('message');

  let combinedCanvas = null;

  function generateCombinedCanvas(url, customText) {
    return new Promise((resolve, reject) => {
      QRCode.toCanvas(url, { width: 256, color: { dark: '#ffffff', light: '#121212' } }, (error, qrCanvas) => {
        if (error) {
          reject(error);
          return;
        }

        const padding = 20;
        const textHeight = 30;
        const canvas = document.createElement('canvas');
        canvas.width = qrCanvas.width;
        canvas.height = qrCanvas.height + padding + textHeight;

        const ctx = canvas.getContext('2d');

        ctx.fillStyle = "#121212";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.drawImage(qrCanvas, 0, 0);

        if (customText) {
          ctx.fillStyle = '#e0e0e0';
          ctx.font = '20px Arial, sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'top';
          ctx.fillText(customText, canvas.width / 2, qrCanvas.height + padding / 2);
        }

        resolve(canvas);
      });
    });
  }

  async function generateQRCodeFromInput() {
    const url = urlInput.value.trim();
    const customText = customTextInput.value.trim();
    message.textContent = '';
    qrCodeContainer.innerHTML = '';
    downloadBtn.disabled = true;

    if (!url) {
      message.textContent = 'Please enter a valid URL.';
      return;
    }
    try {
      new URL(url);
    } catch {
      message.textContent = 'Invalid URL format.';
      return;
    }

    try {
      combinedCanvas = await generateCombinedCanvas(url, customText);
      qrCodeContainer.appendChild(combinedCanvas);
      downloadBtn.disabled = false;
    } catch (err) {
      message.textContent = 'Error generating QR code.';
    }
  }

  generateBtn.addEventListener('click', generateQRCodeFromInput);

  downloadBtn.addEventListener('click', () => {
    if (!combinedCanvas) return;
    const dataUrl = combinedCanvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.href = dataUrl;
    link.download = 'custom_qrcode.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });

  pasteBtn.addEventListener('click', async () => {
    message.textContent = '';
    try {
      const clipboardText = await navigator.clipboard.readText();
      if (clipboardText) {
        urlInput.value = clipboardText.trim();
        generateQRCodeFromInput();
      } else {
        message.textContent = 'Clipboard is empty or does not contain text.';
      }
    } catch {
      message.textContent = 'Clipboard access denied or not supported.';
    }
  });

  // Generate QR code on Ctrl + V paste in urlInput
  urlInput.addEventListener('paste', (event) => {
    // Delay handling to allow paste to complete
    setTimeout(() => {
      generateQRCodeFromInput();
    }, 100);
  });
</script>

</body>
</html>
